<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyecto Tetris</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.1/p5.min.js"></script>
</head>

<body>

       
    <script>
        const MARGEN_TABLERO=20;
        let reguladorVelocidadTeclas=0;
        let reguladorDeCaida= 0;

        //Dificultad, hacer caer las pÃ¬ezas cada determinada cantidad de tiempo, simulando una especie de gravedad, esto se hace facilmente con un setInterval
        setInterval(()=>{
            if(millis() - reguladorDeCaida < 200){
                return
            }
            reguladorDeCaida=millis();
            tetrimino.moverAbajo()
        },400) 


        //la funcion setup es nativa de p5.js
        //y sirve para ajustar las propiedades inciales de nuestros objetos y variables
        function setup() {
            createCanvas(900, 600);//crea un canvas de 900x600
            tablero= new Tablero();//crea un objeto de la clase tablero. variable global por lo q no lleva let, const
            crearMapeoBaseTetrimino();//crea una matriz de tetriminos
            tetrimino=new Tetrimino();//crea un objeto de la clase tetrimino. variable global por lo q no lleva let, const
            resizeCanvas(
                tablero.ancho + (2*MARGEN_TABLERO),
                tablero.alto + (2*MARGEN_TABLERO + tablero.lado_celda)//redimensiona el canvas
            )
        }
        //la funcion draw es nativa de p5.js
        //sirve para dar instrucciones precisas de dibujo sobre el canvas
        function draw() {
            background("blue");
            tablero.dibujar()
            tetrimino.dibujar()
            keyEventsTetris()
        }

        function keyEventsTetris() {
            if(millis()-reguladorVelocidadTeclas < 100){
                return;
            }
            reguladorVelocidad=millis();
            if (keyIsDown(RIGHT_ARROW)) {
                tetrimino.moverDerecha();
                reguladorDeCaida=millis();
            }
            if(keyIsDown(LEFT_ARROW)){
                tetrimino.moverIzquierda();
                reguladorDeCaida=millis();
            }
            if(keyIsDown(DOWN_ARROW)){
                tetrimino.moverAbajo();
                reguladorDeCaida=millis();
            }
            if(keyIsDown(UP_ARROW)){
                tetrimino.girar();
                reguladorDeCaida=millis();
            }
        }

        

        
    </script>

    <script src="Tablero.js"></script>
    <script src="Tetrimino.js"></script>
</body>

</html>